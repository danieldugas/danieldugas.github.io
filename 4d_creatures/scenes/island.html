<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebGPU Hypercamera Renderer</title>
<style>
body {
  margin: 0;
  padding: 20px;
  font-family: system-ui, -apple-system, sans-serif;
  background: #1a1a1a;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
canvas {
  border: 2px solid #444;
  background: #000;
  max-width: 100%;
}
.controls {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  align-items: center;
}
.control-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}
label {
  font-size: 12px;
  color: #aaa;
}
input[type="range"] {
  width: 150px;
}
.info {
  font-size: 14px;
  color: #888;
  text-align: center;
}
</style>
</head>
<body>
<canvas id="canvas" width="600" height="600"></canvas>
<div class="info">WebGPU Hypercamera Renderer</div>
<script type="module">

import { Transform4D, Vector4D } from '../hyperengine/transform4d.js';
import { Hyperobject, createHypercube, removeDuplicates } from '../hyperengine/hyperobject.js';
import { runHyperengine } from '../hyperengine/hyperengine.js';
import { createPalmTree } from '../models/palm_tree.js';
import { createHypersphere } from '../models/hypersphere.js';
import { createEscapePod } from '../models/escape_pod.js';
import { createHypercrab } from '../models/hypercrab.js';

let hypertree1 = createPalmTree();
hypertree1.pose.translate_self_by_delta(7, 0, 0, 0);
let hypertree2 = createPalmTree();
hypertree2.pose.translate_self_by_delta(-2, 5, 0, 3);
let hypersun = createHypersphere(100, 0xffff44);
hypersun.pose.translate_self_by_delta(1000, 1000, 1000, 0);
let hypership = createEscapePod();
hypership.pose.translate_self_by_delta(0, -5, 2, 2);
let hypercrab = createHypercrab();
hypercrab.pose.translate_self_by_delta(0, 0, 2, -4);
let hypercloud = createHypersphere(1, 0xffffff);
hypercloud.vertices_in_object = hypercloud.vertices_in_object.map(v => new Vector4D(v.x * 100, v.y * 100, v.z * 5, v.w * 5));
hypercloud.pose.translate_self_by_delta(0, 0, 50, -200);

let bigIsland = new Hyperobject(
    // vertices in object frame
    [
        new Vector4D(0, 0, 1, 0),
        new Vector4D(1, 1, -1, 1),
        new Vector4D(1, -1, -1, -1),
        new Vector4D(-1, 1, -1, -1),
        new Vector4D(-1, -1, -1, 1)
    ].map(v => new Vector4D(v.x * 100, v.y * 100, v.z * 30, v.w * 100)),
    // edges
    [
        [0,1],[0,2],[0,3],[0,4],
        [1,2],[1,3],[1,4],
        [2,3],[2,4],
        [3,4]
    ],
    // tetras
    [
        [0,1,2,3],
        [0,1,2,4],
        [0,1,3,4],
        [0,2,3,4],
        [1,2,3,4]
    ],
    // color
    0x005500,
    // simulate_physics
    false,
    // show_vertices
    true,
    // mass
    1.0,
    // pose (Transform4D)
    new Transform4D([
        [1, 0, 0, 0, 0],
        [0, 1, 0, 0, 0],
        [0, 0, 1, 0, 0],
        [0, 0, 0, 1, -200],
        [0, 0, 0, 0, 1]
    ]),
    // name
    "BigIsland"
);

// Check WebGPU support
if (!navigator.gpu) {
  document.body.innerHTML = '<div style="color: red; padding: 20px;">WebGPU is not supported in your browser.</div>';
  throw new Error('WebGPU not supported');
}

const main_canvas = document.getElementById('canvas');

let custom_scene = {
  visibleHyperobjects: [hypership, hypertree1, hypertree2, hypercrab, hypersun, bigIsland, hypercloud],
  mainCanvas: main_canvas,
  floorPreset: 'island',
};

runHyperengine(custom_scene).catch(err => {
  console.error(err);
  document.body.innerHTML += '<div style="color: red; padding: 20px;">Error: ' + err.message + '</div>';
});
</script>
</body>
</html>